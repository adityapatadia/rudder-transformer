[
  {
    "description": "Track Call -> Product Added Event with prev cart state",
    "input": {
      "event": {
        "query_parameters": {
          "topic": ["carts_update"]
        },
        "id": "shopify_v1_test5",
        "line_items": [
          {
            "id": 123,
            "properties": null,
            "quantity": 5,
            "variant_id": 456,
            "key": "some:key",
            "discounted_price": "30.10",
            "discounts": [],
            "gift_card": false,
            "grams": 0,
            "line_price": "60.20",
            "original_line_price": "60.20",
            "original_price": "30.10",
            "price": "30.10",
            "product_id": 987,
            "sku": "",
            "taxable": true,
            "title": "Shirt 2 - LARGE",
            "total_discount": "0.00",
            "vendor": "testAnant"
          },
          {
            "id": 1234,
            "properties": null,
            "quantity": 2,
            "variant_id": 4556,
            "key": "some:key",
            "discounted_price": "20.70",
            "discounts": [],
            "gift_card": false,
            "grams": 0,
            "line_price": "20.00",
            "original_line_price": "60.97",
            "original_price": "20.00",
            "price": "30.00",
            "product_id": 987,
            "sku": "1212",
            "taxable": true,
            "title": "Shirt 3 - LARGE",
            "total_discount": "0.00",
            "vendor": "testAnant"
          }
        ],
        "note": null,
        "updated_at": "2023-02-10T12:05:07.251Z",
        "created_at": "2023-02-10T12:04:04.402Z"
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "context": {
          "library": {
            "name": "RudderStack Shopify Cloud",
            "version": "1.0.0"
          },
          "integration": {
            "name": "SHOPIFY"
          },
          "sessionId": "session_id_5",
          "topic": "carts_update"
        },
        "integrations": {
          "SHOPIFY": true
        },
        "type": "track",
        "event": "Product Added",
        "properties": {
          "cart_id": "shopify_v1_test5",
          "product_id": "987",
          "name": "Shirt 2 - LARGE",
          "brand": "testAnant",
          "price": 30.1,
          "quantity": 3,
          "id": 123,
          "variant_id": 456,
          "key": "some:key",
          "discounted_price": 30.1,
          "discounts": [],
          "gift_card": false,
          "grams": 0,
          "line_price": 60.2,
          "original_line_price": 60.2,
          "original_price": 30.1,
          "taxable": true,
          "total_discount": "0.00"
        },
        "anonymousId": "anon_id_5"
      },
      {
        "context": {
          "library": {
            "name": "RudderStack Shopify Cloud",
            "version": "1.0.0"
          },
          "integration": {
            "name": "SHOPIFY"
          },
          "sessionId": "session_id_5",
          "topic": "carts_update"
        },
        "integrations": {
          "SHOPIFY": true
        },
        "type": "track",
        "event": "Product Added",
        "properties": {
          "cart_id": "shopify_v1_test5",
          "product_id": "987",
          "name": "Shirt 3 - LARGE",
          "brand": "testAnant",
          "price": 30,
          "quantity": 2,
          "sku": "1212",
          "id": 1234,
          "variant_id": 4556,
          "key": "some:key",
          "discounted_price": 20.7,
          "discounts": [],
          "gift_card": false,
          "grams": 0,
          "line_price": 20,
          "original_line_price": 60.97,
          "original_price": 20,
          "taxable": true,
          "total_discount": "0.00"
        },
        "anonymousId": "anon_id_5"
      }
    ]
  },
  {
    "description": "Track Call -> Product Removed Event with prev cart state",
    "input": {
      "event": {
        "query_parameters": {
          "topic": ["carts_update"]
        },
        "id": "shopify_v1_test5",
        "line_items": [],
        "updated_at": "2023-02-10T12:05:07.251Z",
        "created_at": "2023-02-10T12:04:04.402Z"
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "context": {
          "library": {
            "name": "RudderStack Shopify Cloud",
            "version": "1.0.0"
          },
          "integration": {
            "name": "SHOPIFY"
          },
          "sessionId": "session_id_5",
          "topic": "carts_update"
        },
        "integrations": {
          "SHOPIFY": true
        },
        "type": "track",
        "event": "Product Removed",
        "properties": {
          "id": "123",
          "cart_id": "shopify_v1_test5",
          "product_id": "987",
          "name": "Shirt 2 - LARGE",
          "brand": "testAnant",
          "price": 30,
          "quantity": 2,
          "variant_id": 456,
          "key": "some:key"
        },
        "anonymousId": "anon_id_5"
      }
    ]
  },
  {
    "description": "Track Call -> Duplicate Cart Event with prev cart state",
    "input": {
      "event": {
        "query_parameters": {
          "topic": ["carts_update"]
        },
        "id": "shopify_v1_test5",
        "line_items": [
          {
            "id": 123,
            "properties": null,
            "quantity": 2,
            "variant_id": 456,
            "key": "some:key",
            "discounted_price": "30.00",
            "discounts": [],
            "gift_card": false,
            "grams": 0,
            "line_price": "60.00",
            "original_line_price": "60.00",
            "original_price": "30.00",
            "price": "30.00",
            "product_id": 987,
            "sku": "",
            "taxable": true,
            "title": "Shirt 2 - LARGE",
            "total_discount": "0.00",
            "vendor": "testAnant"
          }
        ],
        "note": null,
        "updated_at": "2023-02-10T12:05:07.251Z",
        "created_at": "2023-02-10T12:04:04.402Z"
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "outputToSource": {
          "body": "T0s=",
          "contentType": "text/plain"
        },
        "statusCode": 200
      }
    ]
  },
  {
    "description": "Track Call -> Duplicate Cart Event with prev cart state and no lineItems",
    "input": {
      "event": {
        "query_parameters": {
          "topic": ["carts_update"]
        },
        "id": "shopify_v1_test_cart",
        "line_items": [],
        "updated_at": "2023-02-10T12:05:07.251Z",
        "created_at": "2023-02-10T12:04:04.402Z"
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "outputToSource": {
          "body": "T0s=",
          "contentType": "text/plain"
        },
        "statusCode": 200
      }
    ]
  },
  {
    "description": "Rudder Session Identifier Event redis map set fail",
    "input": {
      "event": {
        "event": "rudderSessionIdentifier",
        "sessionId": "session_id",
        "cartToken": "shopify_v1_test_set_map_fail",
        "query_parameters": {
          "writeKey": ["Shopify Write Key"]
        },
        "cart": {
          "token": "shopify_v1_test_set_map_fail",
          "id": "id",
          "updated_at": "2023-02-10T07:44:06-05:00",
          "line_items": []
        }
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "outputToSource": {
          "body": "T0s=",
          "contentType": "text/plain"
        },
        "statusCode": 200
      }
    ]
  },
  {
    "description": "Track Call -> sessionId Stitching failed due redis error ",
    "input": {
      "event": {
        "cart_token": "shopifyGetSessionId",
        "query_parameters": {
          "topic": ["checkouts_delete"]
        },
        "line_items": [],
        "note": null,
        "updated_at": "2023-02-10T12:16:07.251Z",
        "created_at": "2023-02-10T12:05:04.402Z"
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "context": {
          "cart_token": "shopifyGetSessionId",
          "library": {
            "name": "RudderStack Shopify Cloud",
            "version": "1.0.0"
          },
          "integration": {
            "name": "SHOPIFY"
          },
          "topic": "checkouts_delete"
        },
        "event": "Checkout Deleted",
        "integrations": {
          "SHOPIFY": true
        },
        "type": "track",
        "properties": {
          "created_at": "2023-02-10T12:05:04.402Z",
          "cart_token": "shopifyGetSessionId",
          "cart_id": "shopifyGetSessionId",
          "products": [],
          "updated_at": "2023-02-10T12:16:07.251Z"
        },
        "anonymousId": "97e170ef-d44a-50d7-ad1b-90b079372902"
      }
    ]
  },
  {
    "description": "Track Call -> anonymousId Stitching failed due redis error ",
    "input": {
      "event": {
        "cart_token": "shopifyGetAnonymousId",
        "query_parameters": {
          "topic": ["checkouts_delete"]
        },
        "line_items": [],
        "note": null,
        "updated_at": "2023-02-10T12:16:07.251Z",
        "created_at": "2023-02-10T12:05:04.402Z"
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "context": {
          "cart_token": "shopifyGetAnonymousId",
          "library": {
            "name": "RudderStack Shopify Cloud",
            "version": "1.0.0"
          },
          "integration": {
            "name": "SHOPIFY"
          },
          "topic": "checkouts_delete"
        },
        "event": "Checkout Deleted",
        "integrations": {
          "SHOPIFY": true
        },
        "type": "track",
        "properties": {
          "created_at": "2023-02-10T12:05:04.402Z",
          "cart_token": "shopifyGetAnonymousId",
          "cart_id": "shopifyGetAnonymousId",
          "products": [],
          "updated_at": "2023-02-10T12:16:07.251Z"
        },
        "anonymousId": "19c48fe8-9676-50c1-9ba0-789e4bbb0364"
      }
    ]
  },
  {
    "description": "Track Call -> orders_delete with invalid cartToken",
    "input": {
      "event": {
        "id": "shopify_v1_test3",
        "query_parameters": {
          "topic": ["orders_delete"]
        },
        "line_items": [],
        "note": null,
        "updated_at": "2023-02-10T12:16:07.251Z",
        "created_at": "2023-02-10T12:05:04.402Z"
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "context": {
          "library": {
            "name": "RudderStack Shopify Cloud",
            "version": "1.0.0"
          },
          "integration": {
            "name": "SHOPIFY"
          },
          "topic": "orders_delete"
        },
        "event": "Order Deleted",
        "integrations": {
          "SHOPIFY": true
        },
        "type": "track",
        "userId": "shopify-admin",
        "properties": {
          "created_at": "2023-02-10T12:05:04.402Z",
          "id": "shopify_v1_test3",
          "products": [],
          "updated_at": "2023-02-10T12:16:07.251Z"
        }
      }
    ]
  },
  {
    "description": "Track Call -> checkouts_delete with invalid cartToken",
    "input": {
      "event": {
        "id": "shopify_v1_test3",
        "query_parameters": {
          "topic": ["checkouts_delete"]
        },
        "line_items": [],
        "note": null,
        "updated_at": "2023-02-10T12:16:07.251Z",
        "created_at": "2023-02-10T12:05:04.402Z"
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "context": {
          "library": {
            "name": "RudderStack Shopify Cloud",
            "version": "1.0.0"
          },
          "integration": {
            "name": "SHOPIFY"
          },
          "topic": "checkouts_delete"
        },
        "event": "Checkout Deleted",
        "integrations": {
          "SHOPIFY": true
        },
        "type": "track",
        "properties": {
          "created_at": "2023-02-10T12:05:04.402Z",
          "id": "shopify_v1_test3",
          "products": [],
          "updated_at": "2023-02-10T12:16:07.251Z"
        },
        "anonymousId": "generated_uuid"
      }
    ]
  },
  {
    "description": "Track Call -> orders_updated with empty line_items",
    "input": {
      "event": {
        "note_attributes": [
          {
            "name": "random",
            "value": "RANDOM_VAL"
          }
        ],
        "id": "shopify_v1_test2",
        "query_parameters": {
          "topic": ["orders_updated"]
        },
        "shipping_address": "abc",
        "billing_address": "abc",
        "customer": {
          "first_name": "Test",
          "last_name": "Person"
        },
        "cart_token": null,
        "checkout_id": 36601802719507,
        "checkout_token": "checkout token",
        "client_details": {
          "accept_language": null,
          "browser_height": null,
          "browser_ip": "122.161.73.113",
          "user_agent": "Mozilla/5.0 User Agent"
        },
        "line_items": [],
        "note": null,
        "updated_at": "2023-02-10T12:16:07.251Z",
        "created_at": "2023-02-10T12:05:04.402Z"
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "context": {
          "traits": {
            "shippingAddress": "abc",
            "billingAddress": "abc",
            "firstName": "Test",
            "lastName": "Person"
          },
          "checkout_token": "checkout token",
          "library": {
            "name": "RudderStack Shopify Cloud",
            "version": "1.0.0"
          },
          "integration": {
            "name": "SHOPIFY"
          },
          "topic": "orders_updated"
        },
        "event": "Order Updated",
        "integrations": {
          "SHOPIFY": true
        },
        "type": "track",
        "properties": {
          "checkout_id": "36601802719507",
          "checkout_token": "checkout token",
          "note_attributes": [
            {
              "name": "random",
              "value": "RANDOM_VAL"
            }
          ],
          "client_details": {
            "browser_ip": "122.161.73.113",
            "user_agent": "Mozilla/5.0 User Agent"
          },
          "order_id": "shopify_v1_test2",
          "created_at": "2023-02-10T12:05:04.402Z",
          "products": [],
          "updated_at": "2023-02-10T12:16:07.251Z"
        },
        "traits": {
          "shippingAddress": "abc",
          "billingAddress": "abc",
          "firstName": "Test",
          "lastName": "Person"
        },
        "timestamp": "2023-02-10T12:16:07.251Z",
        "anonymousId": "generated_uuid"
      }
    ]
  },
  {
    "description": "Track Call -> fullfillments_create",
    "input": {
      "event": {
        "query_parameters": {
          "topic": ["fulfillments_create"]
        },
        "order_id": "random",
        "status": "success",
        "created_at": "2023-02-10T07:44:06-05:00",
        "service": "manual",
        "updated_at": "2023-02-10T07:44:06-05:00",
        "tracking_company": null,
        "shipment_status": null,
        "location_id": 77735330067,
        "origin_address": null,
        "destination": null,
        "line_items": [
          {
            "variant_id": "variantId",
            "title": "bitter cloud",
            "quantity": 1,
            "sku": "",
            "variant_title": null,
            "vendor": "testAnant",
            "fulfillment_service": "manual",
            "product_id": 8100634689811,
            "requires_shipping": true,
            "taxable": true,
            "gift_card": false,
            "name": "bitter cloud",
            "variant_inventory_management": null,
            "properties": [],
            "product_exists": true,
            "fulfillable_quantity": 0,
            "grams": 0,
            "price": "9.54",
            "total_discount": "0.00",
            "fulfillment_status": "fulfilled",
            "price_set": {
              "shop_money": {
                "amount": "9.54",
                "currency_code": "GBP"
              },
              "presentment_money": {
                "amount": "9.54",
                "currency_code": "GBP"
              }
            },
            "total_discount_set": {
              "shop_money": {
                "amount": "0.00",
                "currency_code": "GBP"
              },
              "presentment_money": {
                "amount": "0.00",
                "currency_code": "GBP"
              }
            },
            "discount_allocations": [],
            "duties": [],
            "shopify-admin_graphql_api_id": "gid://shopify/LineItem/13729348059411",
            "tax_lines": []
          }
        ],
        "tracking_number": null,
        "tracking_numbers": [],
        "tracking_url": null,
        "tracking_urls": [],
        "receipt": {},
        "name": "#1001.1",
        "shopify-admin_graphql_api_id": "gid://shopify/Fulfillment/4655820210451"
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "userId": "shopify-admin",
        "context": {
          "library": {
            "name": "RudderStack Shopify Cloud",
            "version": "1.0.0"
          },
          "integration": {
            "name": "SHOPIFY"
          },
          "topic": "fulfillments_create"
        },
        "event": "Fulfillments Create",
        "integrations": {
          "SHOPIFY": true
        },
        "type": "track",
        "properties": {
          "shopify-admin_graphql_api_id": "gid://shopify/Fulfillment/4655820210451",
          "created_at": "2023-02-10T07:44:06-05:00",
          "location_id": 77735330067,
          "name": "#1001.1",
          "order_id": "random",
          "products": [
            {
              "shopify-admin_graphql_api_id": "gid://shopify/LineItem/13729348059411",
              "quantity": 1,
              "product_exists": true,
              "name": "bitter cloud",
              "product_id": "8100634689811",
              "properties": [],
              "requires_shipping": true,
              "tax_lines": [],
              "variant_id": "variantId",
              "variant_name": "bitter cloud",
              "price": 9.54,
              "taxable": true,
              "total_discount": "0.00",
              "brand": "testAnant",
              "fulfillable_quantity": 0,
              "fulfillment_service": "manual",
              "fulfillment_status": "fulfilled",
              "gift_card": false,
              "grams": 0,
              "discount_allocations": [],
              "duties": [],
              "price_set": {
                "shop_money": {
                  "amount": "9.54",
                  "currency_code": "GBP"
                },
                "presentment_money": {
                  "amount": "9.54",
                  "currency_code": "GBP"
                }
              },
              "total_discount_set": {
                "shop_money": {
                  "amount": "0.00",
                  "currency_code": "GBP"
                },
                "presentment_money": {
                  "amount": "0.00",
                  "currency_code": "GBP"
                }
              }
            }
          ],
          "receipt": {},
          "service": "manual",
          "status": "success",
          "tracking_numbers": [],
          "tracking_urls": [],
          "updated_at": "2023-02-10T07:44:06-05:00"
        }
      }
    ]
  },
  {
    "description": "Track Call -> checkouts_update-> Payment Info Entered ",
    "input": {
      "event": {
        "id": "shopify_v1_test2",
        "user_id": "rudder01",
        "query_parameters": {
          "topic": ["checkouts_update"]
        },
        "token": "shopify_v1_test2",
        "cart_token": "shopify_v1_test2",
        "note": null,
        "updated_at": "2023-02-10T12:16:07.251Z",
        "created_at": "2023-02-10T12:05:04.402Z"
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "userId": "rudder01",
        "anonymousId": "anon_shopify_v1_test2",
        "context": {
          "sessionId": "session_id_2",
          "cart_token": "shopify_v1_test2",
          "library": {
            "name": "RudderStack Shopify Cloud",
            "version": "1.0.0"
          },
          "integration": {
            "name": "SHOPIFY"
          },
          "topic": "checkouts_update"
        },
        "event": "Checkout Step Viewed",
        "integrations": {
          "SHOPIFY": true
        },
        "type": "track",
        "properties": {
          "products": [],
          "checkout_id": "shopify_v1_test2",
          "created_at": "2023-02-10T12:05:04.402Z",
          "cart_token": "shopify_v1_test2",
          "cart_id": "shopify_v1_test2",
          "user_id": "rudder01",
          "checkout_token": "shopify_v1_test2",
          "updated_at": "2023-02-10T12:16:07.251Z"
        },
        "timestamp": "2023-02-10T12:16:07.251Z"
      }
    ]
  },
  {
    "description": "Track Call -> checkouts_update with rudderAnonymousId inside note_attributes",
    "input": {
      "event": {
        "note_attributes": [
          {
            "name": "rudderAnonymousId",
            "value": "RUDDER_ANON_ID"
          },
          {
            "name": "rudderUpdatedAt",
            "value": "RUDDER_UPDTD_AT"
          }
        ],
        "id": "shopify_v1_test2",
        "query_parameters": {
          "topic": ["checkouts_update"]
        },
        "cart_token": null,
        "line_items": [],
        "note": null,
        "updated_at": "2023-02-10T12:16:07.251Z",
        "created_at": "2023-02-10T12:05:04.402Z"
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "context": {
          "library": {
            "name": "RudderStack Shopify Cloud",
            "version": "1.0.0"
          },
          "integration": {
            "name": "SHOPIFY"
          },
          "topic": "checkouts_update"
        },
        "event": "Checkout Step Viewed",
        "integrations": {
          "SHOPIFY": true
        },
        "type": "track",
        "properties": {
          "checkout_id": "shopify_v1_test2",
          "note_attributes": [
            {
              "name": "rudderAnonymousId",
              "value": "RUDDER_ANON_ID"
            },
            {
              "name": "rudderUpdatedAt",
              "value": "RUDDER_UPDTD_AT"
            }
          ],
          "products": [],
          "created_at": "2023-02-10T12:05:04.402Z",
          "updated_at": "2023-02-10T12:16:07.251Z"
        },
        "timestamp": "2023-02-10T12:16:07.251Z",
        "anonymousId": "RUDDER_ANON_ID"
      }
    ]
  },
  {
    "description": "Track Call -> orders_updated with no mapping for cartToken",
    "input": {
      "event": {
        "id": "order_id",
        "query_parameters": {
          "topic": ["orders_updated"]
        },
        "cart_token": "shopify_v1_test4",
        "line_items": [],
        "note": null,
        "updated_at": "2023-02-10T12:16:07.251Z",
        "created_at": "2023-02-10T12:05:04.402Z"
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "anonymousId": "fec3a2c1-f240-5a66-8148-6d44ab3ab6d3",
        "context": {
          "cart_token": "shopify_v1_test4",
          "integration": {
            "name": "SHOPIFY"
          },
          "library": {
            "name": "RudderStack Shopify Cloud",
            "version": "1.0.0"
          },
          "topic": "orders_updated"
        },
        "event": "Order Updated",
        "integrations": {
          "SHOPIFY": true
        },
        "properties": {
          "created_at": "2023-02-10T12:05:04.402Z",
          "order_id": "order_id",
          "products": [],
          "cart_token": "shopify_v1_test4",
          "cart_id": "shopify_v1_test4",
          "updated_at": "2023-02-10T12:16:07.251Z"
        },
        "timestamp": "2023-02-10T12:16:07.251Z",
        "type": "track"
      }
    ]
  },
  {
    "description": "Rudder Identifier Event",
    "input": {
      "event": {
        "event": "rudderIdentifier",
        "anonymousId": "b9993cc5-9e60-4e69-be0e-4e38c228314b",
        "cartToken": "shopify_v1_test1",
        "query_parameters": {
          "writeKey": ["Shopify Write Key"]
        },
        "cart": {
          "token": "token",
          "id": "id",
          "updated_at": "2023-02-10T07:44:06-05:00",
          "line_items": []
        }
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "outputToSource": {
          "body": "T0s=",
          "contentType": "text/plain"
        },
        "statusCode": 200
      }
    ]
  },
  {
    "description": "Rudder Session Identifier Event",
    "input": {
      "event": {
        "event": "rudderSessionIdentifier",
        "sessionId": "b9993cc5-9e60-4e69-be0e-4e38c228314b",
        "cartToken": "shopify_v1_test1",
        "query_parameters": {
          "writeKey": ["Shopify Write Key"]
        },
        "cart": {
          "token": "token",
          "id": "id",
          "updated_at": "2023-02-10T07:44:06-05:00",
          "line_items": []
        }
      },
      "source": {
        "Config": {
          "version": "v1"
        }
      }
    },
    "output": [
      {
        "outputToSource": {
          "body": "T0s=",
          "contentType": "text/plain"
        },
        "statusCode": 200
      }
    ]
  },
  {
    "description": "Rudder Session Identifier Event through v0",
    "input": {
      "event": {
        "event": "rudderSessionIdentifier",
        "sessionId": "b9993cc5-9e60-4e69-be0e-4e38c228314b",
        "cartToken": "shopify_test1",
        "query_parameters": {
          "writeKey": ["Shopify Write Key"]
        },
        "cart": {
          "token": "token",
          "id": "id",
          "updated_at": "2023-02-10T07:44:06-05:00",
          "line_items": []
        }
      },
      "source": {
        "Config": {
          "version": "v0"
        }
      }
    },
    "output": {
      "outputToSource": {
        "body": "T0s=",
        "contentType": "text/plain"
      },
      "statusCode": 200
    }
  }
]
